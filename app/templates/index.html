<!DOCTYPE html>
<html>
  <head>
  	<script type="text/javascript" src="static/js/angular.min.js"></script>
  	<script type="text/javascript" src="static/js/postmodule.js"></script>
  	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/css/mystyle.css">
    <title>SQLViewer</title>
  </head>
  <body ng-app='myApp'>
        <div ng-controller="myCtrl" id=main>
		<div id=address>
			<form id="db_address" ng-submit="queryDb()">
				<div>
					<label class=caption for="dbaddr_">Db address</label>
    				<input type="text" id="dbaddr_" ng-model="dbAddress" 
    					placeholder="dialect://username:password@host:port/database E.g.: postgresql://scott:tiger@localhost/mydb (for sqlite: sqlite:///path. E.g.: sqlite:////home/data/db.sqlite" class="form-control"/>
    				<button class="btn btn-primary" type="submit">View</button>
    			</div>
		</form>
		</div>
		<div id="schemas">
			<ul class="nav nav-tabs"  ng-if="len(schemas)>1">
			<li class=caption><span>Schemas ({{ '{{' }} len(schemas) {{ '}}' }}):</span></li>
			<li ng-repeat="(schemaName, tables) in schemas"
			ng-class="{active:schemaName==selectedSchemaName}" ng-disabled="!len(tables)">
				<a href value="{{ '{{' }} schemaName  {{ '}}' }}"
					ng-click="setSelectedSchemaName(schemaName)">
				<b>{{ '{{' }} schemaName  {{ '}}' }}</b><br><span class="note">{{ '{{' }} len(tables)  {{ '}}' }} table(s)</span>
				</a>
			</li>
			</ul>
		</div>
		<div id="tables">
			<ul class="nav nav-tabs" ng-if="len(tables)">
			<li class=caption><span>{{ '{{' }} len(tables) != 1 ? "Tables (" + len(tables) +"):" : "Table (1):" {{ '}}' }}</span></li>
			<li ng-repeat="(tableName, numItems) in tables"
			ng-class="{active:tableName==selectedTable.name}" ng-disabled="!numItems">
				<a href value="{{ '{{' }} tableName  {{ '}}' }}"
					ng-click="setSelectedTableName(tableName)">
				<b>{{ '{{' }} tableName  {{ '}}' }}</b><br><span class="note">{{ '{{' }} numItems  {{ '}}' }} row(s)</span>
				</a>
			</li>
			</ul>
		</div>
		<div id="table_content">
			<div ng-if="showSelTableDetails" class="table-details alert alert-info">
    			<a href ng-click="$parent.showSelTableDetails = false" class="close" aria-label="close">×</a>
    			<div>
    				<strong>Primary key</strong> <span class="pk note">pk</span>
    				<div ng-repeat="(key, val) in selectedTable.primaryKey">
    					<span>{{ '{{' }} key {{ '}}' }}</span> <pre>{{ '{{' }} val | json {{ '}}' }}</pre>
    				</div>
    				<p>
    				<p>
    				<strong>{{ '{{' }} len(selectedTable.foreignKeys) + " " + (len(selectedTable.foreignKeys) ==1 ? "Foreign key" : "Foreign keys") {{ '}}' }}</strong> <span class="fk note">fk</span>
    				<div ng-repeat="val in selectedTable.foreignKeys track by $index">
    					<span class="fk note">fk#{{ '{{' }} $index+1 {{ '}}' }}</span> <!-- <pre>{{ '{{' }} val | json {{ '}}' }}</pre> -->
    					<div ng-repeat="(key, subval) in val">
    						<span>{{ '{{' }} key {{ '}}' }}</span> <pre>{{ '{{' }} subval | json {{ '}}' }}</pre>
    					</div>
    				</div>
    				<p>
    				<p>
    				<strong>{{ '{{' }} len(selectedTable.uniqueConstraints) + " " + (len(selectedTable.uniqueConstraints) ==1 ? "Unique Constraint" : "Unique Constraints") {{ '}}' }}</strong> <span class="uc note">uc</span>
    				<div ng-repeat="val in selectedTable.uniqueConstraints track by $index">
    					<span class="uc note">uc#{{ '{{' }} $index+1 {{ '}}' }}</span> <!-- <pre>{{ '{{' }} val | json {{ '}}' }}</pre> -->
    				    <div ng-repeat="(key, subval) in val">
    						<span>{{ '{{' }} key {{ '}}' }}</span> <pre>{{ '{{' }} subval | json {{ '}}' }}</pre>
    					</div>
    				</div>
    				
    			</div>
  			</div>
			<table ng-if="selectedTable" class="table table-bordered table-condensed"> <!--  table-striped">-->
			<thead>
  				<tr>
    				<th ng-repeat="v in selectedTable.columns">
	    				<a href ng-click="toggleColSort(selectedTable.columns[$index])">
	    					{{ '{{' }} v {{ '}}' }}
	    					<span ng-if="selectedTable.columns[$index]==selectedTable.orderColName && selectedTable.orderAscending">
	    						&#8681;<!-- &darr; -->
	    					</span>
	    					<span ng-if="selectedTable.columns[$index]==selectedTable.orderColName && !selectedTable.orderAscending">
	    						&#8679;<!-- &uarr; -->
	    					</span>
	    				</a>
	    				
    				</th>
			    </tr>
			    <tr>
    				<th ng-repeat="v in selectedTable.types track by $index">
	    				<a href ng-click="toggleColSort(selectedTable.columns[$index])">
	    					{{ '{{' }} v {{ '}}' }}
	    				</a>
	    				<span class="pk note" ng-if="isPrimaryKey(selectedTable.columns[$index])">
	    					pk
	    				</span>
	    				<span class="fk note" ng-if="getForeignKeyIndex(selectedTable.columns[$index])>-1">
	    					fk#{{ '{{' }} getForeignKeyIndex(selectedTable.columns[$index])+1 {{ '}}' }}
	    				</span>
	    				<span class="uc note" ng-if="getUniqueConstraintsIndex(selectedTable.columns[$index])>-1">
	    					uc#{{ '{{' }} getUniqueConstraintsIndex(selectedTable.columns[$index])+1 {{ '}}' }}
	    				</span>
    				</th>
			    </tr>
			</thead>
			<tbody>
  				<tr ng-repeat="x in selectedTable.data">
    				<td ng-repeat="v in x track by $index" ng-class="{numeric:selectedTable.typeIsNumeric[$index]}">
    				<textarea ng-if="selectedTable.typeIsText[$index] && v.indexOf('\n') != -1">{{ '{{' }} v {{ '}}' }}</textarea>  <!-- <input ng-if="(v+'').indexOf('\n') == -1" type='text' value="{{ '{{' }} v {{ '}}' }}" /> -->
    				<span ng-if="!selectedTable.typeIsText[$index] || v.indexOf('\n') == -1">{{ '{{' }} v {{ '}}' }}</span>
    				</td>
			   </tr>
			</tbody>
			</table>
		</div>
		<div id=footer>
			<div class=messages>
				<div ng-if="errorMsg ? true : false" class="alert alert-danger">
		    		<a href ng-click="clearErrorMsg()" class="close" aria-label="close">×</a>
		    		{{ '{{' }}errorMsg{{ '}}' }}
		  		</div>
		  		<div ng-if="working" class="working alert alert-info">
		  			<strong>Please wait...</strong>
				</div>
			</div>
			<div class="table-options" ng-if="!showSelTableDetails && len(selectedTable)">
				<a href ng-click="$parent.showSelTableDetails = true">&#9776;</a>
			</div>
		</div>
    </div>
  </body>
</html>